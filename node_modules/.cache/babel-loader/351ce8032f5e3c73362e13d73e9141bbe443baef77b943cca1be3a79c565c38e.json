{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useSelector,useDispatch}from'react-redux';import{useParams,useNavigate}from'react-router-dom';import{fetchMembers}from'../../store/slices/membersSlice';import MemberCard from'../../components/MemberCard/MemberCard';import{sendVote}from'../../store/slices/votingSlice';import'./ConferencePage.scss';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ConferencePage=()=>{const{id}=useParams();const navigate=useNavigate();const dispatch=useDispatch();const{members,status,error}=useSelector(state=>state.members);const[allVoted,setAllVoted]=useState(false);useEffect(()=>{dispatch(fetchMembers(id));},[id,dispatch]);useEffect(()=>{if(members.length>0){const votedAll=members.every(member=>localStorage.getItem(\"voted-\".concat(member.id))==='true');setAllVoted(votedAll);}},[members]);if(status==='loading')return/*#__PURE__*/_jsx(\"div\",{children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0443\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u043E\\u0432...\"});if(status==='failed')return/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \",error]});const handleVote=(memberId,reaction)=>{const voteData={event_id:parseInt(id),member_id:parseInt(memberId),reaction_id:reaction};dispatch(sendVote(voteData));localStorage.setItem(\"voted-\".concat(memberId),'true');setAllVoted(members.every(member=>localStorage.getItem(\"voted-\".concat(member.id))==='true'));};return/*#__PURE__*/_jsxs(\"div\",{className:\"conference-container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0423\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u0438 \\u043A\\u043E\\u043D\\u0444\\u0435\\u0440\\u0435\\u043D\\u0446\\u0438\\u0438\"}),/*#__PURE__*/_jsx(\"div\",{children:members.map(member=>/*#__PURE__*/_jsx(MemberCard,{member:member,onVoteComplete:handleVote},member.id))}),allVoted&&/*#__PURE__*/_jsx(\"button\",{className:\"results-button\",onClick:()=>navigate(\"/results/\".concat(id)),children:\"\\u041F\\u0435\\u0440\\u0435\\u0439\\u0442\\u0438 \\u043D\\u0430 \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u0443 \\u0440\\u0435\\u0437\\u0443\\u043B\\u044C\\u0442\\u0430\\u0442\\u043E\\u0432\"})]});};export default ConferencePage;","map":{"version":3,"names":["React","useEffect","useState","useSelector","useDispatch","useParams","useNavigate","fetchMembers","MemberCard","sendVote","jsx","_jsx","jsxs","_jsxs","ConferencePage","id","navigate","dispatch","members","status","error","state","allVoted","setAllVoted","length","votedAll","every","member","localStorage","getItem","concat","children","handleVote","memberId","reaction","voteData","event_id","parseInt","member_id","reaction_id","setItem","className","map","onVoteComplete","onClick"],"sources":["C:/Roma/repositories/konf_votes/src/pages/Conference/ConferencePage.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { fetchMembers } from '../../store/slices/membersSlice';\r\nimport MemberCard from '../../components/MemberCard/MemberCard';\r\nimport { sendVote } from '../../store/slices/votingSlice';\r\nimport './ConferencePage.scss';\r\n\r\nconst ConferencePage = () => {\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n  const { members, status, error } = useSelector((state) => state.members);\r\n  const [allVoted, setAllVoted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    dispatch(fetchMembers(id));\r\n  }, [id, dispatch]);\r\n\r\n  useEffect(() => {\r\n    if (members.length > 0) {\r\n      const votedAll = members.every(member => localStorage.getItem(`voted-${member.id}`) === 'true');\r\n      setAllVoted(votedAll);\r\n    }\r\n  }, [members]);\r\n\r\n  if (status === 'loading') return <div>Загрузка участников...</div>;\r\n  if (status === 'failed') return <div>Ошибка: {error}</div>;\r\n\r\n  const handleVote = (memberId, reaction) => {\r\n    const voteData = {\r\n      event_id: parseInt(id),\r\n      member_id: parseInt(memberId),\r\n      reaction_id: reaction,\r\n    };\r\n\r\n    dispatch(sendVote(voteData));\r\n\r\n    localStorage.setItem(`voted-${memberId}`, 'true');\r\n    setAllVoted(members.every(member => localStorage.getItem(`voted-${member.id}`) === 'true'));\r\n  };\r\n\r\n  return (\r\n    <div className=\"conference-container\">\r\n      <h1>Участники конференции</h1>\r\n      <div>\r\n        {members.map((member) => (\r\n          <MemberCard key={member.id} member={member} onVoteComplete={handleVote} />\r\n        ))}\r\n      </div>\r\n\r\n      {allVoted && (\r\n        <button className=\"results-button\" onClick={() => navigate(`/results/${id}`)}>\r\n          Перейти на страницу результатов\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ConferencePage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}